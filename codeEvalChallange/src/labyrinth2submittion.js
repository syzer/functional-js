function baseIndexOf(e,t,n){var r=(n||0)-1,i=e?e.length:0;while(++r<i){if(e[r]===t){return r}}return-1}function cacheIndexOf(e,t){var n=typeof t;e=e.cache;if(n=="boolean"||t==null){return e[t]?0:-1}if(n!="number"&&n!="string"){n="object"}var r=n=="number"?t:keyPrefix+t;e=(e=e[n])&&e[r];return n=="object"?e&&baseIndexOf(e,t)>-1?0:-1:e?0:-1}function cachePush(e){var t=this.cache,n=typeof e;if(n=="boolean"||e==null){t[e]=true}else{if(n!="number"&&n!="string"){n="object"}var r=n=="number"?e:keyPrefix+e,i=t[n]||(t[n]={});if(n=="object"){(i[r]||(i[r]=[])).push(e)}else{i[r]=true}}}function charAtCallback(e){return e.charCodeAt(0)}function compareAscending(e,t){var n=e.criteria,r=t.criteria,i=-1,s=n.length;while(++i<s){var o=n[i],u=r[i];if(o!==u){if(o>u||typeof o=="undefined"){return 1}if(o<u||typeof u=="undefined"){return-1}}}return e.index-t.index}function createCache(e){var t=-1,n=e.length,r=e[0],i=e[n/2|0],s=e[n-1];if(r&&typeof r=="object"&&i&&typeof i=="object"&&s&&typeof s=="object"){return false}var o=getObject();o["false"]=o["null"]=o["true"]=o["undefined"]=false;var u=getObject();u.array=e;u.cache=o;u.push=cachePush;while(++t<n){u.push(e[t])}return u}function escapeStringChar(e){return"\\"+stringEscapes[e]}function getArray(){return arrayPool.pop()||[]}function getObject(){return objectPool.pop()||{array:null,cache:null,criteria:null,"false":false,index:0,"null":false,number:null,object:null,push:null,string:null,"true":false,"undefined":false,value:null}}function releaseArray(e){e.length=0;if(arrayPool.length<maxPoolSize){arrayPool.push(e)}}function releaseObject(e){var t=e.cache;if(t){releaseObject(t)}e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null;if(objectPool.length<maxPoolSize){objectPool.push(e)}}function slice(e,t,n){t||(t=0);if(typeof n=="undefined"){n=e?e.length:0}var r=-1,i=n-t||0,s=Array(i<0?0:i);while(++r<i){s[r]=e[t+r]}return s}function runInContext(e){function F(e){return e&&typeof e=="object"&&!ut(e)&&E.call(e,"__wrapped__")?e:new I(e)}function I(e,t){this.__chain__=!!t;this.__wrapped__=e}function R(e){function i(){if(n){var e=slice(n);S.apply(e,arguments)}if(this instanceof i){var s=z(t.prototype),o=t.apply(s,e||arguments);return Ht(o)?o:s}return t.apply(r,e||arguments)}var t=e[0],n=e[2],r=e[4];rt(i,e);return i}function U(e,t,n,r,i){if(n){var s=n(e);if(typeof s!="undefined"){return s}}var o=Ht(e);if(o){var u=d.call(e);if(!cloneableClasses[u]){return e}var a=j[u];switch(u){case boolClass:case dateClass:return new a(+e);case numberClass:case stringClass:return new a(e);case regexpClass:s=a(e.source,reFlags.exec(e));s.lastIndex=e.lastIndex;return s}}else{return e}var f=ut(e);if(t){var l=!r;r||(r=getArray());i||(i=getArray());var c=r.length;while(c--){if(r[c]==e){return i[c]}}s=f?a(e.length):{}}else{s=f?slice(e):dt({},e)}if(f){if(E.call(e,"index")){s.index=e.index}if(E.call(e,"input")){s.input=e.input}}if(!t){return s}r.push(e);i.push(s);(f?rn:xt)(e,function(e,o){s[o]=U(e,t,n,r,i)});if(l){releaseArray(r);releaseArray(i)}return s}function z(e,t){return Ht(e)?k(e):{}}function W(e,t,n){if(typeof e!="function"){return fr}if(typeof t=="undefined"||!("prototype"in e)){return e}var r=e.__bindData__;if(typeof r=="undefined"){if(q.funcNames){r=!e.name}r=r||!q.funcDecomp;if(!r){var i=b.call(e);if(!q.funcNames){r=!reFuncName.test(i)}if(!r){r=reThis.test(i);rt(e,r)}}}if(r===false||r!==true&&r[1]&1){return e}switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return Vn(e,t)}function X(e){function h(){var e=u?s:this;if(r){var p=slice(r);S.apply(p,arguments)}if(i||f){p||(p=slice(arguments));if(i){S.apply(p,i)}if(f&&p.length<o){n|=16&~32;return X([t,l?n:n&~3,p,null,s,o])}}p||(p=arguments);if(a){t=e[c]}if(this instanceof h){e=z(t.prototype);var d=t.apply(e,p);return Ht(d)?d:e}return t.apply(e,p)}var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5];var u=n&1,a=n&2,f=n&4,l=n&8,c=t;rt(h,e);return h}function V(e,t){var n=-1,r=tt(),i=e?e.length:0,s=i>=largeArraySize&&r===baseIndexOf,o=[];if(s){var u=createCache(t);if(u){r=cacheIndexOf;t=u}else{s=false}}while(++n<i){var a=e[n];if(r(t,a)<0){o.push(a)}}if(s){releaseObject(t)}return o}function $(e,t,n,r){var i=(r||0)-1,s=e?e.length:0,o=[];while(++i<s){var u=e[i];if(u&&typeof u=="object"&&typeof u.length=="number"&&(ut(u)||ot(u))){if(!t){u=$(u,t,n)}var a=-1,f=u.length,l=o.length;o.length+=f;while(++a<f){o[l++]=u[a]}}else if(!n){o.push(u)}}return o}function J(e,t,n,r,i,s){if(n){var o=n(e,t);if(typeof o!="undefined"){return!!o}}if(e===t){return e!==0||1/e==1/t}var u=typeof e,a=typeof t;if(e===e&&!(e&&objectTypes[u])&&!(t&&objectTypes[a])){return false}if(e==null||t==null){return e===t}var l=d.call(e),c=d.call(t);if(l==argsClass){l=objectClass}if(c==argsClass){c=objectClass}if(l!=c){return false}switch(l){case boolClass:case dateClass:return+e==+t;case numberClass:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case regexpClass:case stringClass:return e==f(t)}var h=l==arrayClass;if(!h){var p=E.call(e,"__wrapped__"),v=E.call(t,"__wrapped__");if(p||v){return J(p?e.__wrapped__:e,v?t.__wrapped__:t,n,r,i,s)}if(l!=objectClass){return false}var m=e.constructor,g=t.constructor;if(m!=g&&!(Pt(m)&&m instanceof m&&Pt(g)&&g instanceof g)&&"constructor"in e&&"constructor"in t){return false}}var y=!i;i||(i=getArray());s||(s=getArray());var b=i.length;while(b--){if(i[b]==e){return s[b]==t}}var w=0;o=true;i.push(e);s.push(t);if(h){b=e.length;w=t.length;o=w==b;if(o||r){while(w--){var S=b,x=t[w];if(r){while(S--){if(o=J(e[S],x,n,r,i,s)){break}}}else if(!(o=J(e[w],x,n,r,i,s))){break}}}}else{Et(t,function(t,u,a){if(E.call(a,u)){w++;return o=E.call(e,u)&&J(e[u],t,n,r,i,s)}});if(o&&!r){Et(e,function(e,t,n){if(E.call(n,t)){return o=--w>-1}})}}i.pop();s.pop();if(y){releaseArray(i);releaseArray(s)}return o}function K(e,t,n,r,i){(ut(t)?rn:xt)(t,function(t,s){var o,u,a=t,f=e[s];if(t&&((u=ut(t))||It(t))){var l=r.length;while(l--){if(o=r[l]==t){f=i[l];break}}if(!o){var c;if(n){a=n(f,t);if(c=typeof a!="undefined"){f=a}}if(!c){f=u?ut(f)?f:[]:It(f)?f:{}}r.push(t);i.push(f);if(!c){K(f,t,n,r,i)}}}else{if(n){a=n(f,t);if(typeof a=="undefined"){a=t}}if(typeof a!="undefined"){f=a}}e[s]=f})}function Q(e,t){return e+y(B()*(t-e+1))}function G(e,t,n){var r=-1,i=tt(),s=e?e.length:0,o=[];var u=!t&&s>=largeArraySize&&i===baseIndexOf,a=n||u?getArray():o;if(u){var f=createCache(a);i=cacheIndexOf;a=f}while(++r<s){var l=e[r],c=n?n(l,r,e):l;if(t?!r||a[a.length-1]!==c:i(a,c)<0){if(n||u){a.push(c)}o.push(l)}}if(u){releaseArray(a.array);releaseObject(a)}else if(n){releaseArray(a)}return o}function Y(e){return function(t,n,r){var i={};n=F.createCallback(n,r,3);var s=-1,o=t?t.length:0;if(typeof o=="number"){while(++s<o){var u=t[s];e(i,u,n(u,s,t),t)}}else{xt(t,function(t,r,s){e(i,t,n(t,r,s),s)})}return i}}function Z(e,t,n,r,i,s){var o=t&1,u=t&2,a=t&4,f=t&8,c=t&16,h=t&32;if(!u&&!Pt(e)){throw new l}if(c&&!n.length){t&=~16;c=n=false}if(h&&!r.length){t&=~32;h=r=false}var p=e&&e.__bindData__;if(p&&p!==true){p=slice(p);if(p[2]){p[2]=slice(p[2])}if(p[3]){p[3]=slice(p[3])}if(o&&!(p[1]&1)){p[4]=i}if(!o&&p[1]&1){t|=8}if(a&&!(p[1]&4)){p[5]=s}if(c){S.apply(p[2]||(p[2]=[]),n)}if(h){N.apply(p[3]||(p[3]=[]),r)}p[1]|=t;return Z.apply(null,p)}var d=t==1||t===17?R:X;return d([e,t,n,r,i,s])}function et(e){return lt[e]}function tt(){var e=(e=F.indexOf)===An?baseIndexOf:e;return e}function nt(e){return typeof e=="function"&&v.test(e)}function it(e){var t,n;if(!(e&&d.call(e)==objectClass)||(t=e.constructor,Pt(t)&&!(t instanceof t))){return false}Et(e,function(e,t){n=t});return typeof n=="undefined"||E.call(e,n)}function st(e){return ct[e]}function ot(e){return e&&typeof e=="object"&&typeof e.length=="number"&&d.call(e)==argsClass||false}function vt(e,t,n,r){if(typeof t!="boolean"&&t!=null){r=n;n=t;t=false}return U(e,t,typeof n=="function"&&W(n,r,1))}function mt(e,t,n){return U(e,true,typeof t=="function"&&W(t,n,1))}function gt(e,t){var n=z(e);return t?dt(n,t):n}function bt(e,t,n){var r;t=F.createCallback(t,n,3);xt(e,function(e,n,i){if(t(e,n,i)){r=n;return false}});return r}function wt(e,t,n){var r;t=F.createCallback(t,n,3);Tt(e,function(e,n,i){if(t(e,n,i)){r=n;return false}});return r}function St(e,t,n){var r=[];Et(e,function(e,t){r.push(t,e)});var i=r.length;t=W(t,n,3);while(i--){if(t(r[i--],r[i],e)===false){break}}return e}function Tt(e,t,n){var r=ft(e),i=r.length;t=W(t,n,3);while(i--){var s=r[i];if(t(e[s],s,e)===false){break}}return e}function Nt(e){var t=[];Et(e,function(e,n){if(Pt(e)){t.push(n)}});return t.sort()}function Ct(e,t){return e?E.call(e,t):false}function kt(e){var t=-1,n=ft(e),r=n.length,i={};while(++t<r){var s=n[t];i[e[s]]=s}return i}function Lt(e){return e===true||e===false||e&&typeof e=="object"&&d.call(e)==boolClass||false}function At(e){return e&&typeof e=="object"&&d.call(e)==dateClass||false}function Ot(e){return e&&e.nodeType===1||false}function Mt(e){var t=true;if(!e){return t}var n=d.call(e),r=e.length;if(n==arrayClass||n==stringClass||n==argsClass||n==objectClass&&typeof r=="number"&&Pt(e.splice)){return!r}xt(e,function(){return t=false});return t}function _t(e,t,n,r){return J(e,t,typeof n=="function"&&W(n,r,2))}function Dt(e){return A(e)&&!O(parseFloat(e))}function Pt(e){return typeof e=="function"}function Ht(e){return!!(e&&objectTypes[typeof e])}function Bt(e){return Ft(e)&&e!=+e}function jt(e){return e===null}function Ft(e){return typeof e=="number"||e&&typeof e=="object"&&d.call(e)==numberClass||false}function qt(e){return e&&typeof e=="object"&&d.call(e)==regexpClass||false}function Rt(e){return typeof e=="string"||e&&typeof e=="object"&&d.call(e)==stringClass||false}function Ut(e){return typeof e=="undefined"}function zt(e,t,n){var r={};t=F.createCallback(t,n,3);xt(e,function(e,n,i){r[n]=t(e,n,i)});return r}function Wt(e){var t=arguments,n=2;if(!Ht(e)){return e}if(typeof t[2]!="number"){n=t.length}if(n>3&&typeof t[n-2]=="function"){var r=W(t[--n-1],t[n--],2)}else if(n>2&&typeof t[n-1]=="function"){r=t[--n]}var i=slice(arguments,1,n),s=-1,o=getArray(),u=getArray();while(++s<n){K(e,i[s],r,o,u)}releaseArray(o);releaseArray(u);return e}function Xt(e,t,n){var r={};if(typeof t!="function"){var i=[];Et(e,function(e,t){i.push(t)});i=V(i,$(arguments,true,false,1));var s=-1,o=i.length;while(++s<o){var u=i[s];r[u]=e[u]}}else{t=F.createCallback(t,n,3);Et(e,function(e,n,i){if(!t(e,n,i)){r[n]=e}})}return r}function Vt(e){var n=-1,r=ft(e),i=r.length,s=t(i);while(++n<i){var o=r[n];s[n]=[o,e[o]]}return s}function $t(e,t,n){var r={};if(typeof t!="function"){var i=-1,s=$(arguments,true,false,1),o=Ht(e)?s.length:0;while(++i<o){var u=s[i];if(u in e){r[u]=e[u]}}}else{t=F.createCallback(t,n,3);Et(e,function(e,n,i){if(t(e,n,i)){r[n]=e}})}return r}function Jt(e,t,n,r){var i=ut(e);if(n==null){if(i){n=[]}else{var s=e&&e.constructor,o=s&&s.prototype;n=z(o)}}if(t){t=F.createCallback(t,r,4);(i?rn:xt)(e,function(e,r,i){return t(n,e,r,i)})}return n}function Kt(e){var n=-1,r=ft(e),i=r.length,s=t(i);while(++n<i){s[n]=e[r[n]]}return s}function Qt(e){var n=arguments,r=-1,i=$(n,true,false,1),s=n[2]&&n[2][n[1]]===e?1:i.length,o=t(s);while(++r<s){o[r]=e[i[r]]}return o}function Gt(e,t,n){var r=-1,i=tt(),s=e?e.length:0,o=false;n=(n<0?D(0,s+n):n)||0;if(ut(e)){o=i(e,t,n)>-1}else if(typeof s=="number"){o=(Rt(e)?e.indexOf(t,n):i(e,t,n))>-1}else{xt(e,function(e){if(++r>=n){return!(o=e===t)}})}return o}function Zt(e,t,n){var r=true;t=F.createCallback(t,n,3);var i=-1,s=e?e.length:0;if(typeof s=="number"){while(++i<s){if(!(r=!!t(e[i],i,e))){break}}}else{xt(e,function(e,n,i){return r=!!t(e,n,i)})}return r}function en(e,t,n){var r=[];t=F.createCallback(t,n,3);var i=-1,s=e?e.length:0;if(typeof s=="number"){while(++i<s){var o=e[i];if(t(o,i,e)){r.push(o)}}}else{xt(e,function(e,n,i){if(t(e,n,i)){r.push(e)}})}return r}function tn(e,t,n){t=F.createCallback(t,n,3);var r=-1,i=e?e.length:0;if(typeof i=="number"){while(++r<i){var s=e[r];if(t(s,r,e)){return s}}}else{var o;xt(e,function(e,n,r){if(t(e,n,r)){o=e;return false}});return o}}function nn(e,t,n){var r;t=F.createCallback(t,n,3);sn(e,function(e,n,i){if(t(e,n,i)){r=e;return false}});return r}function rn(e,t,n){var r=-1,i=e?e.length:0;t=t&&typeof n=="undefined"?t:W(t,n,3);if(typeof i=="number"){while(++r<i){if(t(e[r],r,e)===false){break}}}else{xt(e,t)}return e}function sn(e,t,n){var r=e?e.length:0;t=t&&typeof n=="undefined"?t:W(t,n,3);if(typeof r=="number"){while(r--){if(t(e[r],r,e)===false){break}}}else{var i=ft(e);r=i.length;xt(e,function(e,n,s){n=i?i[--r]:--r;return t(s[n],n,s)})}return e}function an(e,n){var r=slice(arguments,2),i=-1,s=typeof n=="function",o=e?e.length:0,u=t(typeof o=="number"?o:0);rn(e,function(e){u[++i]=(s?n:e[n]).apply(e,r)});return u}function fn(e,n,r){var i=-1,s=e?e.length:0;n=F.createCallback(n,r,3);if(typeof s=="number"){var o=t(s);while(++i<s){o[i]=n(e[i],i,e)}}else{o=[];xt(e,function(e,t,r){o[++i]=n(e,t,r)})}return o}function ln(e,t,n){var r=-Infinity,i=r;if(typeof t!="function"&&n&&n[t]===e){t=null}if(t==null&&ut(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];if(u>i){i=u}}}else{t=t==null&&Rt(e)?charAtCallback:F.createCallback(t,n,3);rn(e,function(e,n,s){var o=t(e,n,s);if(o>r){r=o;i=e}})}return i}function cn(e,t,n){var r=Infinity,i=r;if(typeof t!="function"&&n&&n[t]===e){t=null}if(t==null&&ut(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];if(u<i){i=u}}}else{t=t==null&&Rt(e)?charAtCallback:F.createCallback(t,n,3);rn(e,function(e,n,s){var o=t(e,n,s);if(o<r){r=o;i=e}})}return i}function pn(e,t,n,r){if(!e)return n;var i=arguments.length<3;t=F.createCallback(t,r,4);var s=-1,o=e.length;if(typeof o=="number"){if(i){n=e[++s]}while(++s<o){n=t(n,e[s],s,e)}}else{xt(e,function(e,r,s){n=i?(i=false,e):t(n,e,r,s)})}return n}function dn(e,t,n,r){var i=arguments.length<3;t=F.createCallback(t,r,4);sn(e,function(e,r,s){n=i?(i=false,e):t(n,e,r,s)});return n}function vn(e,t,n){t=F.createCallback(t,n,3);return en(e,function(e,n,r){return!t(e,n,r)})}function mn(e,t,n){if(e&&typeof e.length!="number"){e=Kt(e)}if(t==null||n){return e?e[Q(0,e.length-1)]:undefined}var r=gn(e);r.length=P(D(0,t),r.length);return r}function gn(e){var n=-1,r=e?e.length:0,i=t(typeof r=="number"?r:0);rn(e,function(e){var t=Q(0,++n);i[n]=i[t];i[t]=e});return i}function yn(e){var t=e?e.length:0;return typeof t=="number"?t:ft(e).length}function bn(e,t,n){var r;t=F.createCallback(t,n,3);var i=-1,s=e?e.length:0;if(typeof s=="number"){while(++i<s){if(r=t(e[i],i,e)){break}}}else{xt(e,function(e,n,i){return!(r=t(e,n,i))})}return!!r}function wn(e,n,r){var i=-1,s=ut(n),o=e?e.length:0,u=t(typeof o=="number"?o:0);if(!s){n=F.createCallback(n,r,3)}rn(e,function(e,t,r){var o=u[++i]=getObject();if(s){o.criteria=fn(n,function(t){return e[t]})}else{(o.criteria=getArray())[0]=n(e,t,r)}o.index=i;o.value=e});o=u.length;u.sort(compareAscending);while(o--){var a=u[o];u[o]=a.value;if(!s){releaseArray(a.criteria)}releaseObject(a)}return u}function En(e){if(e&&typeof e.length=="number"){return slice(e)}return Kt(e)}function xn(e){var t=-1,n=e?e.length:0,r=[];while(++t<n){var i=e[t];if(i){r.push(i)}}return r}function Tn(e){return V(e,$(arguments,true,true,1))}function Nn(e,t,n){var r=-1,i=e?e.length:0;t=F.createCallback(t,n,3);while(++r<i){if(t(e[r],r,e)){return r}}return-1}function Cn(e,t,n){var r=e?e.length:0;t=F.createCallback(t,n,3);while(r--){if(t(e[r],r,e)){return r}}return-1}function kn(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&t!=null){var s=-1;t=F.createCallback(t,n,3);while(++s<i&&t(e[s],s,e)){r++}}else{r=t;if(r==null||n){return e?e[0]:undefined}}return slice(e,0,P(D(0,r),i))}function Ln(e,t,n,r){if(typeof t!="boolean"&&t!=null){r=n;n=typeof t!="function"&&r&&r[t]===e?null:t;t=false}if(n!=null){e=fn(e,n,r)}return $(e,t)}function An(e,t,n){if(typeof n=="number"){var r=e?e.length:0;n=n<0?D(0,r+n):n||0}else if(n){var i=Fn(e,t);return e[i]===t?i:-1}return baseIndexOf(e,t,n)}function On(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&t!=null){var s=i;t=F.createCallback(t,n,3);while(s--&&t(e[s],s,e)){r++}}else{r=t==null||n?1:t||r}return slice(e,0,P(D(0,i-r),i))}function Mn(){var e=[],t=-1,n=arguments.length,r=getArray(),i=tt(),s=i===baseIndexOf,o=getArray();while(++t<n){var u=arguments[t];if(ut(u)||ot(u)){e.push(u);r.push(s&&u.length>=largeArraySize&&createCache(t?e[t]:o))}}var a=e[0],f=-1,l=a?a.length:0,c=[];e:while(++f<l){var h=r[0];u=a[f];if((h?cacheIndexOf(h,u):i(o,u))<0){t=n;(h||o).push(u);while(--t){h=r[t];if((h?cacheIndexOf(h,u):i(e[t],u))<0){continue e}}c.push(u)}}while(n--){h=r[n];if(h){releaseObject(h)}}releaseArray(r);releaseArray(o);return c}function _n(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&t!=null){var s=i;t=F.createCallback(t,n,3);while(s--&&t(e[s],s,e)){r++}}else{r=t;if(r==null||n){return e?e[i-1]:undefined}}return slice(e,D(0,i-r))}function Dn(e,t,n){var r=e?e.length:0;if(typeof n=="number"){r=(n<0?D(0,r+n):P(n,r-1))+1}while(r--){if(e[r]===t){return r}}return-1}function Pn(e){var t=arguments,n=0,r=t.length,i=e?e.length:0;while(++n<r){var s=-1,o=t[n];while(++s<i){if(e[s]===o){T.call(e,s--,1);i--}}}return e}function Hn(e,n,r){e=+e||0;r=typeof r=="number"?r:+r||1;if(n==null){n=e;e=0}var i=-1,s=D(0,m((n-e)/(r||1))),o=t(s);while(++i<s){o[i]=e;e+=r}return o}function Bn(e,t,n){var r=-1,i=e?e.length:0,s=[];t=F.createCallback(t,n,3);while(++r<i){var o=e[r];if(t(o,r,e)){s.push(o);T.call(e,r--,1);i--}}return s}function jn(e,t,n){if(typeof t!="number"&&t!=null){var r=0,i=-1,s=e?e.length:0;t=F.createCallback(t,n,3);while(++i<s&&t(e[i],i,e)){r++}}else{r=t==null||n?1:D(0,t)}return slice(e,r)}function Fn(e,t,n,r){var i=0,s=e?e.length:i;n=n?F.createCallback(n,r,1):fr;t=n(t);while(i<s){var o=i+s>>>1;n(e[o])<t?i=o+1:s=o}return i}function In(){return G($(arguments,true,true))}function qn(e,t,n,r){if(typeof t!="boolean"&&t!=null){r=n;n=typeof t!="function"&&r&&r[t]===e?null:t;t=false}if(n!=null){n=F.createCallback(n,r,3)}return G(e,t,n)}function Rn(e){return V(e,slice(arguments,1))}function Un(){var e=-1,t=arguments.length;while(++e<t){var n=arguments[e];if(ut(n)||ot(n)){var r=r?G(V(r,n).concat(V(n,r))):n}}return r||[]}function zn(){var e=arguments.length>1?arguments:arguments[0],n=-1,r=e?ln(hn(e,"length")):0,i=t(r<0?0:r);while(++n<r){i[n]=hn(e,n)}return i}function Wn(e,t){var n=-1,r=e?e.length:0,i={};if(!t&&r&&!ut(e[0])){t=[]}while(++n<r){var s=e[n];if(t){i[s]=t[n]}else if(s){i[s[0]]=s[1]}}return i}function Xn(e,t){if(!Pt(t)){throw new l}return function(){if(--e<1){return t.apply(this,arguments)}}}function Vn(e,t){return arguments.length>2?Z(e,17,slice(arguments,2),null,t):Z(e,1,null,null,t)}function $n(e){var t=arguments.length>1?$(arguments,true,false,1):Nt(e),n=-1,r=t.length;while(++n<r){var i=t[n];e[i]=Z(e[i],1,null,null,e)}return e}function Jn(e,t){return arguments.length>2?Z(t,19,slice(arguments,2),null,e):Z(t,3,null,null,e)}function Kn(){var e=arguments,t=e.length;while(t--){if(!Pt(e[t])){throw new l}}return function(){var t=arguments,n=e.length;while(n--){t=[e[n].apply(this,t)]}return t[0]}}function Qn(e,t){t=typeof t=="number"?t:+t||e.length;return Z(e,4,null,null,null,t)}function Gn(e,t,n){var r,i,s,o,u,a,f,c=0,h=false,p=true;if(!Pt(e)){throw new l}t=D(0,t)||0;if(n===true){var d=true;p=false}else if(Ht(n)){d=n.leading;h="maxWait"in n&&(D(t,n.maxWait)||0);p="trailing"in n?n.trailing:p}var v=function(){var n=t-(pr()-o);if(n<=0){if(i){g(i)}var l=f;i=a=f=undefined;if(l){c=pr();s=e.apply(u,r);if(!a&&!i){r=u=null}}}else{a=x(v,n)}};var m=function(){if(a){g(a)}i=a=f=undefined;if(p||h!==t){c=pr();s=e.apply(u,r);if(!a&&!i){r=u=null}}};return function(){r=arguments;o=pr();u=this;f=p&&(a||!d);if(h===false){var n=d&&!a}else{if(!i&&!d){c=o}var l=h-(o-c),y=l<=0;if(y){if(i){i=g(i)}c=o;s=e.apply(u,r)}else if(!i){i=x(m,l)}}if(y&&a){a=g(a)}else if(!a&&t!==h){a=x(v,t)}if(n){y=true;s=e.apply(u,r)}if(y&&!a&&!i){r=u=null}return s}}function Yn(e){if(!Pt(e)){throw new l}var t=slice(arguments,1);return x(function(){e.apply(undefined,t)},1)}function Zn(e,t){if(!Pt(e)){throw new l}var n=slice(arguments,2);return x(function(){e.apply(undefined,n)},t)}function er(e,t){if(!Pt(e)){throw new l}var n=function(){var r=n.cache,i=t?t.apply(this,arguments):keyPrefix+arguments[0];return E.call(r,i)?r[i]:r[i]=e.apply(this,arguments)};n.cache={};return n}function tr(e){var t,n;if(!Pt(e)){throw new l}return function(){if(t){return n}t=true;n=e.apply(this,arguments);e=null;return n}}function nr(e){return Z(e,16,slice(arguments,1))}function rr(e){return Z(e,32,null,slice(arguments,1))}function ir(e,t,n){var r=true,i=true;if(!Pt(e)){throw new l}if(n===false){r=false}else if(Ht(n)){r="leading"in n?n.leading:r;i="trailing"in n?n.trailing:i}debounceOptions.leading=r;debounceOptions.maxWait=t;debounceOptions.trailing=i;return Gn(e,t,debounceOptions)}function sr(e,t){return Z(t,16,[e])}function or(e){return function(){return e}}function ur(e,t,n){var r=typeof e;if(e==null||r=="function"){return W(e,t,n)}if(r!="object"){return vr(e)}var i=ft(e),s=i[0],o=e[s];if(i.length==1&&o===o&&!Ht(o)){return function(e){var t=e[s];return o===t&&(o!==0||1/o==1/t)}}return function(t){var n=i.length,r=false;while(n--){if(!(r=J(t[i[n]],e[i[n]],null,true))){break}}return r}}function ar(e){return e==null?"":f(e).replace(pt,et)}function fr(e){return e}function lr(e,t,n){var r=true,i=t&&Nt(t);if(!t||!n&&!i.length){if(n==null){n=t}s=I;t=e;e=F;i=Nt(t)}if(n===false){r=false}else if(Ht(n)&&"chain"in n){r=n.chain}var s=e,o=Pt(s);rn(i,function(n){var i=e[n]=t[n];if(o){s.prototype[n]=function(){var t=this.__chain__,n=this.__wrapped__,o=[n];S.apply(o,arguments);var u=i.apply(e,o);if(r||t){if(n===u&&Ht(u)){return this}u=new s(u);u.__chain__=t}return u}}})}function cr(){e._=p;return this}function hr(){}function vr(e){return function(t){return t[e]}}function mr(e,t,n){var r=e==null,i=t==null;if(n==null){if(typeof e=="boolean"&&i){n=e;e=1}else if(!i&&typeof t=="boolean"){n=t;i=true}}if(r&&i){t=1}e=+e||0;if(i){t=e;e=0}else{t=+t||0}if(n||e%1||t%1){var s=B();return P(e+s*(t-e+parseFloat("1e-"+((s+"").length-1))),t)}return Q(e,t)}function gr(e,t){if(e){var n=e[t];return Pt(n)?e[t]():n}}function yr(e,t,n){var r=F.templateSettings;e=f(e||"");n=yt({},n,r);var s=yt({},n.imports,r.imports),o=ft(s),u=Kt(s);var l,c=0,h=n.interpolate||reNoMatch,p="__p += '";var d=a((n.escape||reNoMatch).source+"|"+h.source+"|"+(h===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(n.evaluate||reNoMatch).source+"|$","g");e.replace(d,function(t,n,r,i,s,o){r||(r=i);p+=e.slice(c,o).replace(reUnescapedString,escapeStringChar);if(n){p+="' +\n__e("+n+") +\n'"}if(s){l=true;p+="';\n"+s+";\n__p += '"}if(r){p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"}c=o+t.length;return t});p+="';\n";var v=n.variable,m=v;if(!m){v="obj";p="with ("+v+") {\n"+p+"\n}\n"}p=(l?p.replace(reEmptyStringLeading,""):p).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");p="function("+v+") {\n"+(m?"":v+" || ("+v+" = {});\n")+"var __t, __p = '', __e = _.escape"+(l?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g="\n/*\n//# sourceURL="+(n.sourceURL||"/lodash/template/source["+templateCounter++ +"]")+"\n*/";try{var y=i(o,"return "+p+g).apply(undefined,u)}catch(b){b.source=p;throw b}if(t){return y(t)}y.source=p;return y}function br(e,n,r){e=(e=+e)>-1?e:0;var i=-1,s=t(e);n=W(n,r,1);while(++i<e){s[i]=n(i)}return s}function wr(e){return e==null?"":f(e).replace(ht,st)}function Er(e){var t=++idCounter;return f(e==null?"":e)+t}function Sr(e){e=new I(e);e.__chain__=true;return e}function xr(e,t){t(e);return e}function Tr(){this.__chain__=true;return this}function Nr(){return f(this.__wrapped__)}function Cr(){return this.__wrapped__}e=e?_.defaults(root.Object(),e,_.pick(root,contextProps)):root;var t=e.Array,n=e.Boolean,r=e.Date,i=e.Function,s=e.Math,o=e.Number,u=e.Object,a=e.RegExp,f=e.String,l=e.TypeError;var c=[];var h=u.prototype;var p=e._;var d=h.toString;var v=a("^"+f(d).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");var m=s.ceil,g=e.clearTimeout,y=s.floor,b=i.prototype.toString,w=nt(w=u.getPrototypeOf)&&w,E=h.hasOwnProperty,S=c.push,x=e.setTimeout,T=c.splice,N=c.unshift;var C=function(){try{var e={},t=nt(t=u.defineProperty)&&t,n=t(e,e,e)&&t}catch(r){}return n}();var k=nt(k=u.create)&&k,L=nt(L=t.isArray)&&L,A=e.isFinite,O=e.isNaN,M=nt(M=u.keys)&&M,D=s.max,P=s.min,H=e.parseInt,B=s.random;var j={};j[arrayClass]=t;j[boolClass]=n;j[dateClass]=r;j[funcClass]=i;j[objectClass]=u;j[numberClass]=o;j[regexpClass]=a;j[stringClass]=f;I.prototype=F.prototype;var q=F.support={};q.funcDecomp=!nt(e.WinRTError)&&reThis.test(runInContext);q.funcNames=typeof i.name=="string";F.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:reInterpolate,variable:"",imports:{_:F}};if(!k){z=function(){function t(){}return function(n){if(Ht(n)){t.prototype=n;var r=new t;t.prototype=null}return r||e.Object()}}()}var rt=!C?hr:function(e,t){descriptor.value=t;C(e,"__bindData__",descriptor)};var ut=L||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&d.call(e)==arrayClass||false};var at=function(e){var t,n=e,r=[];if(!n)return r;if(!objectTypes[typeof e])return r;for(t in n){if(E.call(n,t)){r.push(t)}}return r};var ft=!M?at:function(e){if(!Ht(e)){return[]}return M(e)};var lt={"&":"&","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var ct=kt(lt);var ht=a("("+ft(ct).join("|")+")","g"),pt=a("["+ft(lt).join("")+"]","g");var dt=function(e,t,n){var r,i=e,s=i;if(!i)return s;var o=arguments,u=0,a=typeof n=="number"?2:o.length;if(a>3&&typeof o[a-2]=="function"){var f=W(o[--a-1],o[a--],2)}else if(a>2&&typeof o[a-1]=="function"){f=o[--a]}while(++u<a){i=o[u];if(i&&objectTypes[typeof i]){var l=-1,c=objectTypes[typeof i]&&ft(i),h=c?c.length:0;while(++l<h){r=c[l];s[r]=f?f(s[r],i[r]):i[r]}}}return s};var yt=function(e,t,n){var r,i=e,s=i;if(!i)return s;var o=arguments,u=0,a=typeof n=="number"?2:o.length;while(++u<a){i=o[u];if(i&&objectTypes[typeof i]){var f=-1,l=objectTypes[typeof i]&&ft(i),c=l?l.length:0;while(++f<c){r=l[f];if(typeof s[r]=="undefined")s[r]=i[r]}}}return s};var Et=function(e,t,n){var r,i=e,s=i;if(!i)return s;if(!objectTypes[typeof i])return s;t=t&&typeof n=="undefined"?t:W(t,n,3);for(r in i){if(t(i[r],r,e)===false)return s}return s};var xt=function(e,t,n){var r,i=e,s=i;if(!i)return s;if(!objectTypes[typeof i])return s;t=t&&typeof n=="undefined"?t:W(t,n,3);var o=-1,u=objectTypes[typeof i]&&ft(i),a=u?u.length:0;while(++o<a){r=u[o];if(t(i[r],r,e)===false)return s}return s};var It=!w?it:function(e){if(!(e&&d.call(e)==objectClass)){return false}var t=e.valueOf,n=nt(t)&&(n=w(t))&&w(n);return n?e==n||w(e)==n:it(e)};var Yt=Y(function(e,t,n){E.call(e,n)?e[n]++:e[n]=1});var on=Y(function(e,t,n){(E.call(e,n)?e[n]:e[n]=[]).push(t)});var un=Y(function(e,t,n){e[n]=t});var hn=fn;var Sn=en;var pr=nt(pr=r.now)&&pr||function(){return(new r).getTime()};var dr=H(whitespace+"08")==8?H:function(e,t){return H(Rt(e)?e.replace(reLeadingSpacesAndZeros,""):e,t||0)};F.after=Xn;F.assign=dt;F.at=Qt;F.bind=Vn;F.bindAll=$n;F.bindKey=Jn;F.chain=Sr;F.compact=xn;F.compose=Kn;F.constant=or;F.countBy=Yt;F.create=gt;F.createCallback=ur;F.curry=Qn;F.debounce=Gn;F.defaults=yt;F.defer=Yn;F.delay=Zn;F.difference=Tn;F.filter=en;F.flatten=Ln;F.forEach=rn;F.forEachRight=sn;F.forIn=Et;F.forInRight=St;F.forOwn=xt;F.forOwnRight=Tt;F.functions=Nt;F.groupBy=on;F.indexBy=un;F.initial=On;F.intersection=Mn;F.invert=kt;F.invoke=an;F.keys=ft;F.map=fn;F.mapValues=zt;F.max=ln;F.memoize=er;F.merge=Wt;F.min=cn;F.omit=Xt;F.once=tr;F.pairs=Vt;F.partial=nr;F.partialRight=rr;F.pick=$t;F.pluck=hn;F.property=vr;F.pull=Pn;F.range=Hn;F.reject=vn;F.remove=Bn;F.rest=jn;F.shuffle=gn;F.sortBy=wn;F.tap=xr;F.throttle=ir;F.times=br;F.toArray=En;F.transform=Jt;F.union=In;F.uniq=qn;F.values=Kt;F.where=Sn;F.without=Rn;F.wrap=sr;F.xor=Un;F.zip=zn;F.zipObject=Wn;F.collect=fn;F.drop=jn;F.each=rn;F.eachRight=sn;F.extend=dt;F.methods=Nt;F.object=Wn;F.select=en;F.tail=jn;F.unique=qn;F.unzip=zn;lr(F);F.clone=vt;F.cloneDeep=mt;F.contains=Gt;F.escape=ar;F.every=Zt;F.find=tn;F.findIndex=Nn;F.findKey=bt;F.findLast=nn;F.findLastIndex=Cn;F.findLastKey=wt;F.has=Ct;F.identity=fr;F.indexOf=An;F.isArguments=ot;F.isArray=ut;F.isBoolean=Lt;F.isDate=At;F.isElement=Ot;F.isEmpty=Mt;F.isEqual=_t;F.isFinite=Dt;F.isFunction=Pt;F.isNaN=Bt;F.isNull=jt;F.isNumber=Ft;F.isObject=Ht;F.isPlainObject=It;F.isRegExp=qt;F.isString=Rt;F.isUndefined=Ut;F.lastIndexOf=Dn;F.mixin=lr;F.noConflict=cr;F.noop=hr;F.now=pr;F.parseInt=dr;F.random=mr;F.reduce=pn;F.reduceRight=dn;F.result=gr;F.runInContext=runInContext;F.size=yn;F.some=bn;F.sortedIndex=Fn;F.template=yr;F.unescape=wr;F.uniqueId=Er;F.all=Zt;F.any=bn;F.detect=tn;F.findWhere=tn;F.foldl=pn;F.foldr=dn;F.include=Gt;F.inject=pn;lr(function(){var e={};xt(F,function(t,n){if(!F.prototype[n]){e[n]=t}});return e}(),false);F.first=kn;F.last=_n;F.sample=mn;F.take=kn;F.head=kn;xt(F,function(e,t){var n=t!=="sample";if(!F.prototype[t]){F.prototype[t]=function(t,r){var i=this.__chain__,s=e(this.__wrapped__,t,r);return!i&&(t==null||r&&!(n&&typeof t=="function"))?s:new I(s,i)}}});F.VERSION="2.4.1";F.prototype.chain=Tr;F.prototype.toString=Nr;F.prototype.value=Cr;F.prototype.valueOf=Cr;rn(["join","pop","shift"],function(e){var t=c[e];F.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new I(n,e):n}});rn(["push","reverse","sort","unshift"],function(e){var t=c[e];F.prototype[e]=function(){t.apply(this.__wrapped__,arguments);return this}});rn(["concat","slice","splice"],function(e){var t=c[e];F.prototype[e]=function(){return new I(t.apply(this.__wrapped__,arguments),this.__chain__)}});return F}var undefined;var arrayPool=[],objectPool=[];var idCounter=0;var keyPrefix=+(new Date)+"";var largeArraySize=75;var maxPoolSize=40;var whitespace=" 	\f ﻿"+"\n\r\u2028\u2029"+" ᠎             　";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reFuncName=/^\s*function[ \n\r\t]+\w/;var reInterpolate=/<%=([\s\S]+?)%>/g;var reLeadingSpacesAndZeros=RegExp("^["+whitespace+"]*0+(?=.$)");var reNoMatch=/($^)/;var reThis=/\bthis\b/;var reUnescapedString=/['\n\r\t\u2028\u2029\\]/g;var contextProps=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"];var templateCounter=0;var argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",funcClass="[object Function]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]";var cloneableClasses={};cloneableClasses[funcClass]=false;cloneableClasses[argsClass]=cloneableClasses[arrayClass]=cloneableClasses[boolClass]=cloneableClasses[dateClass]=cloneableClasses[numberClass]=cloneableClasses[objectClass]=cloneableClasses[regexpClass]=cloneableClasses[stringClass]=true;var debounceOptions={leading:false,maxWait:0,trailing:false};var descriptor={configurable:false,enumerable:false,value:null,writable:false};var objectTypes={"boolean":false,"function":true,object:true,number:false,string:false,"undefined":false};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"};var root=objectTypes[typeof window]&&window||this;var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports;var freeGlobal=objectTypes[typeof global]&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)){root=freeGlobal}var _=runInContext();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root._=_;define(function(){return _})}else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=_)._=_}else{freeExports._=_}}else{root._=_}

var fs = require('fs');
var input = fs.readFileSync(process.argv[2]);

// [x,y] , [x,y]
function mapDistance(el, el2) {
    return (Math.abs(el[0] - el2[0]))
        + Math.abs(el[1] - el2[1]);
}

var memorizedCartesianDistance = _.memoize(cartesianDistance, function(el, el2){
    return [el, el2];
});

// [x,y] -> number
function cartesianDistance(el, el2) {
    return Math.pow((el2[0] - el[0]), 2) + Math.pow((el2[1] - el[1]), 2);
}

function zeros(dimensions) {
    var array = [];

    for (var i = 0; i < dimensions[0]; ++i) {
        array.push(dimensions.length == 1 ? 0 : zeros(dimensions.slice(1)));
    }

    return array;
}

function findRoutes(lines, array) {
    var routes = [];
    lines.forEach(function (line, i) {
        _.forEach(line, function (char, j) {
            if (char === ' ') {
                routes.push([j, i])
            }
        });

    });
    return routes;
}

function findAttached(node, array) {
    return _.filter(array, function (el, i) {
        if (cartesianDistance(node, el) === 1) {
            return true;
        }
    });
}

var memoizedAttachedNodes = _.memoize(findAttached);

//TODO memoize
function calcHeuristicDistances(children, visited, finishNode) {
    var distances = [];
    children.forEach(function (child) {
        if (!_.some(visited, child)) {
            distances.push({node: child, distance: cartesianDistance(child, finishNode)});
        }
    });
    return _.sortBy(distances, 'distance');
}

var memoizedCalcHeuristicDistances = _.memoize(calcHeuristicDistances);

function traverse(node, array, visited, finishNode, callback) {
    // exit condition
    if (_.some([node], finishNode)) {
        visited.push(node);
        callback(visited);
        return visited;
    }

//    var children = findAttached(node, array);
    var children = memoizedAttachedNodes(node, array);
//    var orderedChildren = calcHeuristicDistances(children, visited, finishNode);
    // 17.9 => 5s
    var orderedChildren = memoizedCalcHeuristicDistances(children, visited, finishNode);

    visited.push(node);
    orderedChildren.forEach(function (child) {
        //TODO nodes distances recalc skip
        return traverse(child.node, array, _.clone(visited), finishNode, callback);
    });
}

function findEntryPoints(array) {
    return [_.first(array), _.last(array)];
}

function decode(input) {
    var array, visited = [];
    var lines = input.toString().split('\n');
    var xLength = lines[0].length;

    // maybe cut last line
    if (lines[lines.length - 1] === '') {
        lines.pop();
    }
    var yLength = lines.length;

    array = findRoutes(lines, zeros([xLength, yLength])); // 1200+ in large example

    var entries = findEntryPoints(array);

    var answers = [], timerId;  // can find over 8 routes

    // TODO traverse return null
    traverse(entries[0], array, [], entries[1], drawBestResult);

    function drawBestResult(visited) {
        answers.push({length: visited.length, answer: reconstructOutput(lines, visited)});
        if (timerId) {
            clearTimeout(timerId);
        }
        timerId = setTimeout(function () {
            console.log(_(answers)
                    .min('length')
                    .value()
                    .answer
            );
        }, 600);
    }

    return;
}

function reconstructOutput(lines, visited) {
    var newLines = [];

    lines.forEach(function (line, i) {
        newLines.push(_.map(line, function (char, j) {
            if (char === '*') {
                return char;
            }
            if ((char === ' ') && (_.some(visited, [j, i]))) {
                return '+';
            } else {
                return ' ';
            }
        }).join(''));
    });

    return newLines.join('\n');
}

module.exports.decode = decode;
module.exports.findEntryPoints = findEntryPoints;
module.exports.mapDistance = mapDistance;
module.exports.cartesianDistance = memorizedCartesianDistance; //cartesianDistance;
module.exports.findAttached = findAttached;

decode(input);
